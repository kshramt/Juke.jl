#!/usr/bin/env julia

using Juke


function main(args)
    pargs = Juke.parse_args(args, @__FILE__)
    JukeBox = Module()
    expr = quote
        using Juke
        const cd = Juke.cd
        const cp = Juke.cp
        const run = Juke.run
        const mv = Juke.mv
        const rm = Juke.rm
        const sh = Juke.sh

        const __juke_dsl__ = Juke.make_dsl()
        const finish = __juke_dsl__[:finish]
        const job = __juke_dsl__[:job]
        const desc = __juke_dsl__[:desc]

        include($(joinpath(pwd(), pargs["file"])))
        finish(
            $(pargs["targets"]),
            $(pargs["keep-going"]),
            $(pargs["jobs"]),
            $(pargs["print-dependencies"]),
            $(pargs["descriptions"]),
        )
    end
    eval(JukeBox, expr)
end

if realpath(PROGRAM_FILE) == realpath(@__FILE__)
    main(ARGS)
end
