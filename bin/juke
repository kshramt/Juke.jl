#!/usr/bin/env julia

using Juke


function main(args)
    parsed_args = Juke.parse_args(args)
    JukeContext = Module()
    expr = quote
        using Juke
        const cd = Juke.cd
        const run = Juke.run
        const sh = Juke.sh
        const rm = Juke.rm

        const __juke_dsl__ = Juke.new_dsl()
        const finish = __juke_dsl__[1]
        const job = __juke_dsl__[2]

        include($(joinpath(pwd(), parsed_args["file"])))
        finish($(parsed_args["targets"]), $(parsed_args["print_dependencies"]))
    end
    eval(JukeContext, expr)
end

if realpath(PROGRAM_FILE) == realpath(@__FILE__)
    main(ARGS)
end
